{% extends 'base.html' %}
{% block title %}Обмены · SkillSwap{% endblock %}
{% block content %}
<div class="container">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
      <h1 class="text-xl font-semibold">Мои обмены</h1>
      <div style="display:flex;gap:.5rem;flex-wrap:wrap;">
        <a class="btn btn-ghost" href="{% url 'accounts:inbox_requests' %}">Входящие</a>
        <a class="btn btn-primary" href="{% url 'accounts:exchange_create' %}">Создать запрос</a>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-top:.5rem;flex-wrap:wrap;">
      <div class="muted">Сортировка:</div>
      <div style="display:flex;gap:.5rem;">
        <a class="btn btn-ghost" href="?sort=-created_at">Новые</a>
        <a class="btn btn-ghost" href="?sort=created_at">Старые</a>
        <a class="btn btn-ghost" href="?sort=status">Статус A→Z</a>
        <a class="btn btn-ghost" href="?sort=-status">Статус Z→A</a>
      </div>
    </div>
    <div style="margin-top:1rem;display:grid;gap:.6rem;">
      {% for ex in items %}
        <div class="feature" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;">
          <a class="muted" href="{% url 'accounts:exchange_detail' ex.pk %}" style="text-decoration:none;">
            <span style="color:#fff;font-weight:600;">{{ ex.skill.name }}</span>
            — {{ ex.sender }} ↔ {{ ex.receiver }}
            {% if ex.status == 'pending' %}<span class="badge badge-warn">pending</span>{% endif %}
            {% if ex.status == 'accepted' %}<span class="badge badge-success">accepted</span>{% endif %}
            {% if ex.status == 'declined' %}<span class="badge badge-danger">declined</span>{% endif %}
            {% if ex.status == 'completed' %}<span class="badge badge-info">completed</span>{% endif %}
          </a>
          <div class="form-actions">
            {% if user == ex.receiver and ex.status == 'pending' %}
              <form method="post" action="{% url 'accounts:exchange_accept' ex.pk %}">{% csrf_token %}<button class="btn btn-primary">Принять</button></form>
              <form method="post" action="{% url 'accounts:exchange_decline' ex.pk %}">{% csrf_token %}<button class="btn btn-outline">Отклонить</button></form>
            {% endif %}
            {% if user == ex.sender or user == ex.receiver %}
              {% if ex.status == 'accepted' or ex.status == 'pending' %}
                <form method="post" action="{% url 'accounts:exchange_confirm' ex.pk %}">{% csrf_token %}<button class="btn btn-ghost">Подтвердить</button></form>
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% empty %}
        <div class="muted">Пока нет обменов</div>
      {% endfor %}
    </div>
    {% if items.has_other_pages %}
      <div style="display:flex;gap:.5rem;justify-content:center;margin-top:1rem;">
        {% if items.has_previous %}
          <a class="btn btn-ghost" href="?page={{ items.previous_page_number }}&sort={{ sort }}">Назад</a>
        {% endif %}
        <span class="muted">Стр. {{ items.number }} из {{ items.paginator.num_pages }}</span>
        {% if items.has_next %}
          <a class="btn btn-ghost" href="?page={{ items.next_page_number }}&sort={{ sort }}">Вперед</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}


