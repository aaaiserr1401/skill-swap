{% extends 'base.html' %}
{% block title %}Управление пользователями · Админ-панель{% endblock %}
{% block content %}
<div class="container" style="max-width:1200px;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
    <h1 class="text-2xl font-bold">Управление пользователями</h1>
    <a href="{% url 'accounts:admin_dashboard' %}" class="btn btn-outline">← Назад</a>
  </div>
  
  <!-- Поиск -->
  <div class="card" style="margin-bottom:1rem;">
    <form method="get" style="display:flex; gap:0.5rem;">
      <input type="text" name="q" value="{{ search_query }}" placeholder="Поиск по username, email, имени..." style="flex:1;">
      <button type="submit" class="btn btn-primary">Найти</button>
    </form>
  </div>
  
  <!-- Список пользователей -->
  <div class="card">
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="border-bottom:1px solid var(--outline);">
          <th style="padding:0.5rem; text-align:left;">Username</th>
          <th style="padding:0.5rem; text-align:left;">Email</th>
          <th style="padding:0.5rem; text-align:left;">Имя</th>
          <th style="padding:0.5rem; text-align:left;">Баллы</th>
          <th style="padding:0.5rem; text-align:left;">Дата регистрации</th>
          <th style="padding:0.5rem; text-align:left;">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr style="border-bottom:1px solid var(--outline);">
            <td style="padding:0.5rem;">{{ user.username }}</td>
            <td style="padding:0.5rem;">{{ user.email|default:"—" }}</td>
            <td style="padding:0.5rem;">{{ user.full_name|default:"—" }}</td>
            <td style="padding:0.5rem;">{{ user.points }}</td>
            <td style="padding:0.5rem;">{{ user.date_joined|date:"d.m.Y" }}</td>
            <td style="padding:0.5rem;">
              <a href="{% url 'accounts:admin_user_detail' user.id %}" class="btn btn-outline" style="padding:0.25rem 0.5rem; font-size:0.9rem;">Детали</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" style="padding:1rem; text-align:center;" class="muted">Пользователи не найдены</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    
    <!-- Пагинация -->
    {% if users.has_other_pages %}
      <div style="margin-top:1rem; text-align:center;">
        {% if users.has_previous %}
          <a href="?page={{ users.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}" class="btn btn-outline">← Назад</a>
        {% endif %}
        <span class="muted" style="padding:0 1rem;">Страница {{ users.number }} из {{ users.paginator.num_pages }}</span>
        {% if users.has_next %}
          <a href="?page={{ users.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}" class="btn btn-outline">Вперед →</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

